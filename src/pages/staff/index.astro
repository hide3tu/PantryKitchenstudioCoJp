---
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";
import SectionHeading from "@components/ui/SectionHeading.astro";
import { getAllTags } from "@lib/tags";

const allStaff = await getCollection("staff");
const sortedStaff = allStaff.sort((a, b) => a.data.order - b.data.order);

// worksで使用されているタグ一覧を取得
const allTags = await getAllTags();
const tagNames = new Set(allTags.map((t) => t.tag));
---

<BaseLayout
  title="スタッフ紹介"
  description="テキストパントリーのスタッフをご紹介します。ゲームシナリオ、ノベライズ、アニメ脚本など、各分野のプロフェッショナルが在籍しています。"
>
  <section class="section-spacing">
    <div class="container-content">
      <SectionHeading
        title="スタッフ紹介"
        titleEn="Staff"
        subtitle="物語を紡ぐプロフェッショナルたち"
        align="center"
      />

      <div class="mt-16 space-y-24">
        {
          sortedStaff.map((staff, index) => (
            <article
              id={staff.id}
              class:list={[
                "grid lg:grid-cols-2 gap-12 items-center scroll-mt-24",
                index % 2 === 1 && "lg:direction-rtl",
              ]}
            >
              {/* 画像 */}
              <div class="lg:direction-ltr">
                <div class="relative aspect-square max-w-md mx-auto lg:mx-0 overflow-hidden bg-[var(--color-muted)]">
                  <img
                    src={staff.data.image}
                    alt={staff.data.name}
                    class="staff-img w-full h-full object-contain"
                    loading="lazy"
                    decoding="async"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                  />
                  <div class="staff-placeholder hidden w-full h-full items-center justify-center absolute inset-0 bg-[var(--color-muted)]">
                    <span class="font-serif text-6xl md:text-8xl text-[var(--color-muted-foreground)]">{staff.data.name.charAt(0)}</span>
                  </div>
                </div>
              </div>

              {/* コンテンツ */}
              <div class="lg:direction-ltr">
                {staff.data.nameEn && (
                  <span class="font-display text-sm text-[var(--color-muted-foreground)] block mb-2">
                    {staff.data.nameEn}
                  </span>
                )}
                <h2 class="text-3xl md:text-4xl font-serif mb-4">{staff.data.name}</h2>
                <p class="text-[var(--color-muted-foreground)] mb-6">{staff.data.role}</p>

                <div class="prose prose-lg">
                  <p class="leading-relaxed text-[var(--color-muted-foreground)]">
                    {staff.data.bio}
                  </p>
                </div>

                {staff.data.skills && staff.data.skills.length > 0 && (
                  <div class="mt-8">
                    <h3 class="text-sm font-medium mb-3">得意分野</h3>
                    <div class="flex flex-wrap gap-2">
                      {staff.data.skills.map((skill) => (
                        tagNames.has(skill) ? (
                          <a
                            href={`/works/tag/${skill}/`}
                            class="skill-tag px-3 py-1 text-sm bg-[var(--color-muted)] border border-[var(--color-border)] transition-all duration-300"
                          >
                            {skill}
                          </a>
                        ) : (
                          <span class="px-3 py-1 text-sm bg-[var(--color-muted)] border border-[var(--color-border)]">
                            {skill}
                          </span>
                        )
                      ))}
                    </div>
                  </div>
                )}

                {staff.data.social && (
                  <div class="mt-8 flex gap-4">
                    {staff.data.social.twitter && (
                      <a
                        href={staff.data.social.twitter}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-sm text-[var(--color-muted-foreground)] hover:text-[var(--color-foreground)] transition-colors"
                      >
                        Twitter / X →
                      </a>
                    )}
                    {staff.data.social.website && (
                      <a
                        href={staff.data.social.website}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-sm text-[var(--color-muted-foreground)] hover:text-[var(--color-foreground)] transition-colors"
                      >
                        Website →
                      </a>
                    )}
                  </div>
                )}
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .lg\:direction-rtl {
    direction: rtl;
  }
  .lg\:direction-ltr {
    direction: ltr;
  }
  .skill-tag:hover {
    background-color: #1a1a1a;
    color: #ffffff;
    border-color: #1a1a1a;
    opacity: 1;
  }
</style>
